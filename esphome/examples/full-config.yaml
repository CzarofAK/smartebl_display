# ============================================
# SmartEBL Display - Full Configuration Example
# ============================================
# Complete example for ESP32 with Nextion Display
#
# INSTRUCTIONS:
# 1. Copy this file to your ESPHome directory
# 2. Rename to "motorhome-display.yaml"
# 3. Customize substitutions and entity_id
# 4. Flash to ESP32

# ============================================
# SUBSTITUTIONS (CUSTOMIZE!)
# ============================================

substitutions:
  device_name: motorhome-display
  friendly_name: "Motorhome Display"

  # UART Pins for Nextion (CUSTOMIZE!)
  nextion_tx_pin: GPIO17
  nextion_rx_pin: GPIO16

# ============================================
# ESP32 BOARD
# ============================================

esphome:
  name: ${device_name}
  friendly_name: ${friendly_name}

  # Optional: Execute status check on boot
  on_boot:
    priority: -100
    then:
      - script.execute: check_alarms
      - lambda: |-
          ESP_LOGI("main", "SmartEBL Display started!");

esp32:
  board: esp32dev  # ← CUSTOMIZE for your board
  framework:
    type: arduino

# ============================================
# WIFI & API
# ============================================

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password

  # Fallback Hotspot
  ap:
    ssid: "${device_name} Fallback"
    password: !secret ap_password

# Home Assistant API
api:
  encryption:
    key: !secret api_encryption_key

# OTA Updates
ota:
  - platform: esphome
    password: !secret ota_password

# Web Server (optional)
web_server:
  port: 80

# ============================================
# LOGGING
# ============================================

logger:
  level: INFO  # DEBUG for more details
  baud_rate: 0  # UART is used by Nextion!

# ============================================
# PACKAGES (Modular System)
# ============================================

packages:
  # Base: ESP32 + Nextion UART
  display_base: !include display-base.yaml

  # Master Warning/Caution System
  alarms: !include display-alarms.yaml

  # Sections (only enable what you need!)
  electric: !include sections/electric.yaml
  status: !include sections/status.yaml

  # Optional: Additional sections
  # water: !include sections/water.yaml
  # climate: !include sections/climate.yaml
  # power: !include sections/power.yaml

# ============================================
# CUSTOM SENSORS (CUSTOMIZE!)
# ============================================
# Add your own sensors that are not in packages

sensor:
  # Example: Internal Temperature Sensor
  - platform: homeassistant
    id: internal_temperature
    entity_id: sensor.internal_temperature
    internal: false

# ============================================
# CUSTOM BINARY SENSORS
# ============================================

binary_sensor:
  # Example: Door Contact
  - platform: homeassistant
    id: door_open
    entity_id: binary_sensor.door_contact
    on_press:
      then:
        - lambda: |-
            ESP_LOGI("door", "Door opened!");
            // Optional: Nextion Update
            // id(nextion_display).set_component_text("door_status", "OPEN");

# ============================================
# SWITCHES
# ============================================

switch:
  # Example: Control Interior Light
  - platform: homeassistant
    id: interior_light
    entity_id: switch.interior_light

# ============================================
# CUSTOM SCRIPTS
# ============================================

script:
  # Example: Night Mode
  - id: night_mode
    then:
      - lambda: |-
          // Reduce display brightness at night
          id(nextion_display).set_backlight_brightness(0.3);
          ESP_LOGI("main", "Night mode activated");

# ============================================
# AUTOMATIONS (optional)
# ============================================

# Example: Auto Night Mode
time:
  - platform: homeassistant
    id: ha_time
    on_time:
      # At 22:00 → Night Mode
      - hours: 22
        minutes: 0
        then:
          - script.execute: night_mode

      # At 07:00 → Normal Mode
      - hours: 7
        minutes: 0
        then:
          - lambda: |-
              id(nextion_display).set_backlight_brightness(0.8);
              ESP_LOGI("main", "Day mode activated");

# ============================================
# STATUS LED (optional, if ESP32 has LED)
# ============================================

light:
  - platform: status_led
    name: "${device_name} Status LED"
    pin: GPIO2  # ← CUSTOMIZE

# ============================================
# NOTES
# ============================================
#
# 1. Add secrets to secrets.yaml:
#    wifi_ssid: "Your_WiFi"
#    wifi_password: "YourPassword"
#    api_encryption_key: "32-Character-Key"
#    ota_password: "YourOTAPassword"
#    ap_password: "Fallback-Password"
#
# 2. Customize Display Base GPIO Pins:
#    In display-base.yaml or via Substitutions above
#
# 3. Enable Packages:
#    Comment/uncomment lines as needed
#
# 4. Replace Entity IDs:
#    In the package files (electric.yaml, status.yaml, etc.)
#    or add your own sensors here
#
# 5. Testing:
#    esphome logs motorhome-display.yaml
#
# 6. Flash:
#    esphome run motorhome-display.yaml
