# ============================================
# SmartEBL Display - Full Configuration Example
# ============================================
# Komplettes Beispiel für ESP32 mit Nextion Display
#
# ANLEITUNG:
# 1. Kopiere diese Datei zu deinem ESPHome Verzeichnis
# 2. Benenne um zu "motorhome-display.yaml"
# 3. Passe substitutions und entity_id an
# 4. Flash auf ESP32

# ============================================
# SUBSTITUTIONS (ANPASSEN!)
# ============================================

substitutions:
  device_name: motorhome-display
  friendly_name: "Motorhome Display"
  
  # UART Pins für Nextion (ANPASSEN!)
  nextion_tx_pin: GPIO17
  nextion_rx_pin: GPIO16

# ============================================
# ESP32 BOARD
# ============================================

esphome:
  name: ${device_name}
  friendly_name: ${friendly_name}
  
  # Optional: Beim Boot Status-Check ausführen
  on_boot:
    priority: -100
    then:
      - script.execute: check_alarms
      - lambda: |-
          ESP_LOGI("main", "SmartEBL Display gestartet!");

esp32:
  board: esp32dev  # ← ANPASSEN für dein Board
  framework:
    type: arduino

# ============================================
# WIFI & API
# ============================================

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password
  
  # Fallback Hotspot
  ap:
    ssid: "${device_name} Fallback"
    password: !secret ap_password

# Home Assistant API
api:
  encryption:
    key: !secret api_encryption_key

# OTA Updates
ota:
  - platform: esphome
    password: !secret ota_password

# Web Server (optional)
web_server:
  port: 80

# ============================================
# LOGGING
# ============================================

logger:
  level: INFO  # DEBUG für mehr Details
  baud_rate: 0  # UART wird von Nextion genutzt!

# ============================================
# PACKAGES (Modulares System)
# ============================================

packages:
  # Basis: ESP32 + Nextion UART
  display_base: !include display-base.yaml
  
  # Master Warning/Caution System
  alarms: !include display-alarms.yaml
  
  # Sektionen (nur aktivieren was du brauchst!)
  electric: !include sections/electric.yaml
  status: !include sections/status.yaml
  
  # Optional: Weitere Sektionen
  # water: !include sections/water.yaml
  # climate: !include sections/climate.yaml
  # power: !include sections/power.yaml

# ============================================
# EIGENE SENSOREN (ANPASSEN!)
# ============================================
# Hier kannst du eigene Sensoren hinzufügen die nicht in Packages sind

sensor:
  # Beispiel: Interner Temperatursensor
  - platform: homeassistant
    id: internal_temperature
    entity_id: sensor.internal_temperature
    internal: false
    
# ============================================
# EIGENE BINARY SENSOREN
# ============================================

binary_sensor:
  # Beispiel: Türkontakt
  - platform: homeassistant
    id: door_open
    entity_id: binary_sensor.door_contact
    on_press:
      then:
        - lambda: |-
            ESP_LOGI("door", "Tür geöffnet!");
            // Optional: Nextion Update
            // id(nextion_display).set_component_text("door_status", "OPEN");

# ============================================
# SCHALTER
# ============================================

switch:
  # Beispiel: Licht schalten
  - platform: homeassistant
    id: interior_light
    entity_id: switch.interior_light

# ============================================
# CUSTOM SCRIPTS
# ============================================

script:
  # Beispiel: Night Mode
  - id: night_mode
    then:
      - lambda: |-
          // Reduziere Display-Helligkeit nachts
          id(nextion_display).set_backlight_brightness(0.3);
          ESP_LOGI("main", "Night mode aktiviert");

# ============================================
# AUTOMATIONS (optional)
# ============================================

# Beispiel: Auto Night Mode
time:
  - platform: homeassistant
    id: ha_time
    on_time:
      # Um 22:00 → Night Mode
      - hours: 22
        minutes: 0
        then:
          - script.execute: night_mode
      
      # Um 07:00 → Normal Mode
      - hours: 7
        minutes: 0
        then:
          - lambda: |-
              id(nextion_display).set_backlight_brightness(0.8);
              ESP_LOGI("main", "Day mode aktiviert");

# ============================================
# STATUS LED (optional, wenn ESP32 LED hat)
# ============================================

light:
  - platform: status_led
    name: "${device_name} Status LED"
    pin: GPIO2  # ← ANPASSEN

# ============================================
# HINWEISE
# ============================================
#
# 1. Secrets in secrets.yaml eintragen:
#    wifi_ssid: "Dein_WiFi"
#    wifi_password: "DeinPasswort"
#    api_encryption_key: "32-Zeichen-Key"
#    ota_password: "DeinOTAPassword"
#    ap_password: "Fallback-Password"
#
# 2. Display-Base GPIO Pins anpassen:
#    In display-base.yaml oder via Substitutions oben
#
# 3. Packages aktivieren:
#    Kommentiere Zeilen ein/aus je nach Bedarf
#
# 4. Entity IDs ersetzen:
#    In den Package-Files (electric.yaml, status.yaml, etc.)
#    oder hier eigene Sensoren hinzufügen
#
# 5. Testing:
#    esphome logs motorhome-display.yaml
#
# 6. Flash:
#    esphome run motorhome-display.yaml
