# ============================================
# SmartEBL Display - Electric Section
# ============================================
# Modular Electric section for Battery, Solar, Shore Power
#
# Import in your main.yaml:
#   packages:
#     electric: github://CzarofAK/smartebl_display/esphome/sections/electric.yaml@main

# ============================================
# SENSORS (CUSTOMIZE!)
# ============================================

sensor:
  # Battery Voltage
  - platform: homeassistant
    id: batterie_spannung
    entity_id: sensor.battery_voltage  # ← CUSTOMIZE
    internal: false
    on_value:
      then:
        - lambda: |-
            // Update Nextion Display (only when on Electric Page)
            char buffer[10];
            snprintf(buffer, sizeof(buffer), "%.1fV", x);
            id(nextion_display).set_component_text("bat_volt", buffer);

  # Battery Current
  - platform: homeassistant
    id: batterie_strom
    entity_id: sensor.battery_current  # ← CUSTOMIZE
    internal: false
    on_value:
      then:
        - lambda: |-
            char buffer[10];
            snprintf(buffer, sizeof(buffer), "%.1fA", x);
            id(nextion_display).set_component_text("bat_current", buffer);

  # Battery State of Charge (SOC)
  - platform: homeassistant
    id: batterie_soc
    entity_id: sensor.battery_soc  # ← CUSTOMIZE
    internal: false
    on_value:
      then:
        - lambda: |-
            char buffer[10];
            snprintf(buffer, sizeof(buffer), "%.0f%%", x);
            id(nextion_display).set_component_text("bat_soc", buffer);

            // Change color based on SOC
            int color = 2016;  // Green
            if (x < 20) {
              color = 63488;  // Red (critical)
            } else if (x < 40) {
              color = 64512;  // Orange (low)
            }
            id(nextion_display).set_component_value("bat_soc.pco", color);

  # Solar Power
  - platform: homeassistant
    id: solar_leistung
    entity_id: sensor.solar_power  # ← CUSTOMIZE
    internal: false
    on_value:
      then:
        - lambda: |-
            char buffer[10];
            snprintf(buffer, sizeof(buffer), "%.0fW", x);
            id(nextion_display).set_component_text("solar_power", buffer);

  # Shore Power Status
  - platform: homeassistant
    id: shore_power_strom
    entity_id: sensor.shore_power_current  # ← CUSTOMIZE
    internal: false
    on_value:
      then:
        - lambda: |-
            char buffer[10];
            snprintf(buffer, sizeof(buffer), "%.1fA", x);
            id(nextion_display).set_component_text("shore_current", buffer);

  # Alternator Power
  - platform: homeassistant
    id: alternator_leistung
    entity_id: sensor.alternator_power  # ← CUSTOMIZE
    internal: false
    on_value:
      then:
        - lambda: |-
            char buffer[10];
            snprintf(buffer, sizeof(buffer), "%.0fW", x);
            id(nextion_display).set_component_text("alt_power", buffer);

# ============================================
# BINARY SENSORS
# ============================================

binary_sensor:
  # Shore Power Connected
  - platform: homeassistant
    id: shore_power_connected
    entity_id: binary_sensor.shore_power_connected  # ← CUSTOMIZE
    on_press:
      then:
        - lambda: |-
            id(nextion_display).set_component_text("shore_status", "Connected");
            id(nextion_display).set_component_value("shore_status.pco", 2016);  // Green
    on_release:
      then:
        - lambda: |-
            id(nextion_display).set_component_text("shore_status", "Disconnected");
            id(nextion_display).set_component_value("shore_status.pco", 50712);  // Gray

  # Alternator Active
  - platform: homeassistant
    id: alternator_aktiv
    entity_id: binary_sensor.alternator_active  # ← CUSTOMIZE
    on_press:
      then:
        - lambda: |-
            id(nextion_display).set_component_text("alt_status", "Charging");
            id(nextion_display).set_component_value("alt_status.pco", 2016);  // Green
    on_release:
      then:
        - lambda: |-
            id(nextion_display).set_component_text("alt_status", "Idle");
            id(nextion_display).set_component_value("alt_status.pco", 50712);  // Gray

# ============================================
# SWITCHES (optional)
# ============================================

switch:
  # Example: Inverter On/Off
  - platform: homeassistant
    id: inverter_switch
    entity_id: switch.inverter  # ← CUSTOMIZE

  # Example: Shore Power Auto/Manual
  - platform: homeassistant
    id: shore_power_mode
    entity_id: switch.shore_power_auto  # ← CUSTOMIZE

# ============================================
# NEXTION COMPONENTS (Reference)
# ============================================
#
# Required on Electric_1 Page:
# - Text "bat_volt"      → Battery Voltage
# - Text "bat_current"   → Battery Current
# - Text "bat_soc"       → Battery SOC
# - Text "solar_power"   → Solar Power
# - Text "shore_current" → Shore Power Current
# - Text "shore_status"  → Shore Power Status Text
# - Text "alt_power"     → Alternator Power
# - Text "alt_status"    → Alternator Status Text
#
# On Electric_2 Page (optional, for more details):
# - Number "bat_temp"    → Battery Temperature
# - Text "inverter_status"
# - Dual-state Button for Inverter On/Off
# - etc.

# ============================================
# CUSTOMIZATION NOTES
# ============================================
#
# 1. Replace all entity_id with your Home Assistant Entities
#
# 2. Add more sensors following the same pattern:
#    - platform: homeassistant
#      id: my_sensor
#      entity_id: sensor.my_sensor
#      on_value:
#        - lambda: |-
#            id(nextion_display).set_component_text("nextion_component", to_string(x).c_str());
#
# 3. Customize Nextion component names (e.g. "bat_volt" → your name)
#
# 4. Extend Electric_2 Page with additional details
#
# 5. Optional: Add buttons for control (e.g. Inverter On/Off)
