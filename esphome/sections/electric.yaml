# ============================================
# SmartEBL Display - Electric Section
# ============================================
# Modulare Electric-Sektion für Batterie, Solar, Shore Power
#
# Import in deine main.yaml:
#   packages:
#     electric: github://CzarofAK/smartebl_display/esphome/sections/electric.yaml@main

# ============================================
# SENSOREN (ANPASSEN!)
# ============================================

sensor:
  # Batterie Spannung
  - platform: homeassistant
    id: batterie_spannung
    entity_id: sensor.battery_voltage  # ← ANPASSEN
    internal: false
    on_value:
      then:
        - lambda: |-
            // Update Nextion Display (nur wenn auf Electric Page)
            char buffer[10];
            snprintf(buffer, sizeof(buffer), "%.1fV", x);
            id(nextion_display).set_component_text("bat_volt", buffer);
  
  # Batterie Strom
  - platform: homeassistant
    id: batterie_strom
    entity_id: sensor.battery_current  # ← ANPASSEN
    internal: false
    on_value:
      then:
        - lambda: |-
            char buffer[10];
            snprintf(buffer, sizeof(buffer), "%.1fA", x);
            id(nextion_display).set_component_text("bat_current", buffer);
  
  # Batterie State of Charge (SOC)
  - platform: homeassistant
    id: batterie_soc
    entity_id: sensor.battery_soc  # ← ANPASSEN
    internal: false
    on_value:
      then:
        - lambda: |-
            char buffer[10];
            snprintf(buffer, sizeof(buffer), "%.0f%%", x);
            id(nextion_display).set_component_text("bat_soc", buffer);
            
            // Farbe ändern basierend auf SOC
            int color = 2016;  // Grün
            if (x < 20) {
              color = 63488;  // Rot (kritisch)
            } else if (x < 40) {
              color = 64512;  // Orange (niedrig)
            }
            id(nextion_display).set_component_value("bat_soc.pco", color);
  
  # Solar Leistung
  - platform: homeassistant
    id: solar_leistung
    entity_id: sensor.solar_power  # ← ANPASSEN
    internal: false
    on_value:
      then:
        - lambda: |-
            char buffer[10];
            snprintf(buffer, sizeof(buffer), "%.0fW", x);
            id(nextion_display).set_component_text("solar_power", buffer);
  
  # Shore Power (Landstrom) Status
  - platform: homeassistant
    id: shore_power_strom
    entity_id: sensor.shore_power_current  # ← ANPASSEN
    internal: false
    on_value:
      then:
        - lambda: |-
            char buffer[10];
            snprintf(buffer, sizeof(buffer), "%.1fA", x);
            id(nextion_display).set_component_text("shore_current", buffer);
  
  # Alternator (Lichtmaschine) Leistung
  - platform: homeassistant
    id: alternator_leistung
    entity_id: sensor.alternator_power  # ← ANPASSEN
    internal: false
    on_value:
      then:
        - lambda: |-
            char buffer[10];
            snprintf(buffer, sizeof(buffer), "%.0fW", x);
            id(nextion_display).set_component_text("alt_power", buffer);

# ============================================
# BINARY SENSOREN
# ============================================

binary_sensor:
  # Shore Power Connected
  - platform: homeassistant
    id: shore_power_connected
    entity_id: binary_sensor.shore_power_connected  # ← ANPASSEN
    on_press:
      then:
        - lambda: |-
            id(nextion_display).set_component_text("shore_status", "Connected");
            id(nextion_display).set_component_value("shore_status.pco", 2016);  // Grün
    on_release:
      then:
        - lambda: |-
            id(nextion_display).set_component_text("shore_status", "Disconnected");
            id(nextion_display).set_component_value("shore_status.pco", 50712);  // Grau
  
  # Alternator Aktiv
  - platform: homeassistant
    id: alternator_aktiv
    entity_id: binary_sensor.alternator_active  # ← ANPASSEN
    on_press:
      then:
        - lambda: |-
            id(nextion_display).set_component_text("alt_status", "Charging");
            id(nextion_display).set_component_value("alt_status.pco", 2016);  // Grün
    on_release:
      then:
        - lambda: |-
            id(nextion_display).set_component_text("alt_status", "Idle");
            id(nextion_display).set_component_value("alt_status.pco", 50712);  // Grau

# ============================================
# SCHALTER (optional)
# ============================================

switch:
  # Beispiel: Inverter Ein/Aus
  - platform: homeassistant
    id: inverter_switch
    entity_id: switch.inverter  # ← ANPASSEN
    
  # Beispiel: Shore Power Auto/Manual
  - platform: homeassistant
    id: shore_power_mode
    entity_id: switch.shore_power_auto  # ← ANPASSEN

# ============================================
# NEXTION KOMPONENTEN (Referenz)
# ============================================
# 
# Auf Electric_1 Page benötigt:
# - Text "bat_volt"      → Batterie Spannung
# - Text "bat_current"   → Batterie Strom
# - Text "bat_soc"       → Batterie SOC
# - Text "solar_power"   → Solar Leistung
# - Text "shore_current" → Shore Power Strom
# - Text "shore_status"  → Shore Power Status Text
# - Text "alt_power"     → Alternator Leistung
# - Text "alt_status"    → Alternator Status Text
#
# Auf Electric_2 Page (optional, für weitere Details):
# - Number "bat_temp"    → Batterie Temperatur
# - Text "inverter_status"
# - Dual-state Button für Inverter On/Off
# - etc.

# ============================================
# HINWEISE FÜR ANPASSUNG
# ============================================
#
# 1. Ersetze alle entity_id mit deinen Home Assistant Entities
#
# 2. Füge weitere Sensoren hinzu nach gleichem Muster:
#    - platform: homeassistant
#      id: mein_sensor
#      entity_id: sensor.mein_sensor
#      on_value:
#        - lambda: |-
#            id(nextion_display).set_component_text("nextion_component", to_string(x).c_str());
#
# 3. Passe Nextion Komponenten-Namen an (z.B. "bat_volt" → dein Name)
#
# 4. Erweitere Electric_2 Page mit zusätzlichen Details
#
# 5. Optional: Füge Buttons für Steuerung hinzu (z.B. Inverter On/Off)
