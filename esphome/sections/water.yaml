# ============================================
# SmartEBL Display - Water Section
# ============================================
# Template for water systems (tanks, pumps, etc.)
#
# Import in your main.yaml:
#   packages:
#     water: github://CzarofAK/smartebl_display/esphome/sections/water.yaml@main

# ============================================
# TEMPLATE - CUSTOMIZATION REQUIRED!
# ============================================
# This file is a template. Replace all entity_id
# with your own Home Assistant Entities!

# ============================================
# TANK SENSORS
# ============================================

sensor:
  # Fresh Water Tank Level
  - platform: homeassistant
    id: water_fresh_tank
    entity_id: sensor.fresh_water_tank  # ← CUSTOMIZE
    name: "Fresh Water"
    unit_of_measurement: "L"
    on_value:
      then:
        - lambda: |-
            // Update Nextion (Water_1 Page)
            char buffer[20];
            snprintf(buffer, sizeof(buffer), "%.0fL", x);
            id(nextion_display).set_component_text("fresh_level", buffer);

            // Color based on level
            float tank_max = 100.0;  // ← Adjust tank size
            float percent = (x / tank_max) * 100.0;
            int color = (percent < 20) ? 63488 : (percent < 40) ? 64512 : 2016;
            id(nextion_display).set_component_value("fresh_level.pco", color);

  # Water Pressure
  - platform: homeassistant
    id: water_pressure
    entity_id: sensor.water_pressure  # ← CUSTOMIZE
    name: "Water Pressure"
    unit_of_measurement: "bar"
    on_value:
      then:
        - lambda: |-
            char buffer[10];
            snprintf(buffer, sizeof(buffer), "%.1fbar", x);
            id(nextion_display).set_component_text("water_pressure", buffer);

# ============================================
# PUMPS
# ============================================

binary_sensor:
  # Water Pump Status
  - platform: homeassistant
    id: water_pump_running
    entity_id: binary_sensor.water_pump  # ← CUSTOMIZE
    name: "Water Pump"
    on_press:
      then:
        - lambda: |-
            id(nextion_display).set_component_text("pump_status", "Running");
            id(nextion_display).set_component_value("pump_status.pco", 2016);  // Green
    on_release:
      then:
        - lambda: |-
            id(nextion_display).set_component_text("pump_status", "Off");
            id(nextion_display).set_component_value("pump_status.pco", 50712);  // Gray

switch:
  # Water Pump Control (optional)
  - platform: homeassistant
    id: water_pump_switch
    entity_id: switch.water_pump  # ← CUSTOMIZE

# ============================================
# NEXTION COMPONENTS (Reference)
# ============================================
#
# Required on Water_1 Page:
# - Text "fresh_level"     → Fresh Water Level
# - Text "water_pressure"  → Water Pressure
# - Text "pump_status"     → Pump Status
#
# Optional on Water_2:
# - Text "gray_level"      → Gray Water Level
# - Text "black_level"     → Black Water Level
# - Button "btn_pump"      → Pump On/Off

# ============================================
# CUSTOMIZATION NOTES
# ============================================
#
# 1. Replace all entity_id with your Home Assistant Entities
# 2. Adjust tank sizes (tank_max variables)
# 3. Add more sensors (e.g. boiler temperature)
# 4. Optional: Add control (Pump On/Off)
